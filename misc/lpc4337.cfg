###############################################################################
# Archivo de Configuración OpenOCD Actualizado - EDU-CIAA (LPC4337)
###############################################################################

# --- CONFIGURACIÓN DEL ADAPTADOR (Sintaxis Moderna) ---
adapter driver ftdi
ftdi vid_pid 0x0403 0x6010
ftdi channel 0
ftdi layout_init 0x0708 0xFFFB
ftdi layout_signal nTRST -data 0x0100
ftdi layout_signal nSRST -data 0x0200

transport select jtag
adapter speed 2000

# --- DEFINICIÓN DE TAPS ---
jtag newtap lpc4337 m4 -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id 0x4ba00477
dap create lpc4337.m4.dap -chain-position lpc4337.m4
target create lpc4337.m4 cortex_m -dap lpc4337.m4.dap

jtag newtap lpc4337 m0 -irlen 4 -ircapture 0x1 -irmask 0xf -expected-id 0x0ba01477
dap create lpc4337.m0.dap -chain-position lpc4337.m0
target create lpc4337.m0 cortex_m -dap lpc4337.m0.dap

# --- MEMORIA DE TRABAJO ---
lpc4337.m4 configure -work-area-phys 0x10000000 -work-area-size 0x8000

# --- BANCOS DE FLASH ---
flash bank lpc4337.flasha lpc2000 0x1a000000 0x80000 0 0 lpc4337.m4 lpc4300 96000 calc_checksum
flash bank lpc4337.flashb lpc2000 0x1b000000 0x80000 0 0 lpc4337.m4 lpc4300 96000 calc_checksum

# --- CONFIGURACIÓN DE RESET ---
reset_config none
cortex_m reset_config sysresetreq

targets lpc4337.m4

# --- EVENTOS ---
lpc4337.m4 configure -event gdb-detach {
   echo "Terminate openocd"
   shutdown 0
}